class customSelect{constructor(option){this.selector=option.selector,this.selectAll=document.querySelectorAll(this.selector)}init(){this.renderTemplate(),this.clickEventOut()}reinit(elem){const _this=this;let item=elem.parentNode;item.querySelector(".select-styled")&&(item.querySelector(".select-styled").remove(),item.querySelector(".select-list").remove()),this.renderOption(item)}ajaxOption(item,callback){let xhr=new XMLHttpRequest,result=null;return xhr.open("GET",item.dataset.ajax),xhr.responseType="json",xhr.setRequestHeader("Content-type","application/json; charset=utf-8"),xhr.send(),xhr.onerror=function(){console.err("Error: afSelec ajax request failed")},xhr.onreadystatechange=function(){3==xhr.readyState&&item.closest(".af-select").querySelector(".select-list").classList.add("select-list--load"),4==xhr.readyState&&item.closest(".af-select").querySelector(".select-list").classList.remove("select-list--load")},xhr.onload=function(){callback(xhr.response)},null}renderOption(item){var _this=this,select=item.querySelector("select"),placeholder=select.getAttribute("placeholder"),multiple=select.getAttribute("multiple");const styledSelect=document.createElement("div");styledSelect.classList.add("select-styled"),styledSelect.innerHTML="<span>"+placeholder+"</span>";const styledOptions=document.createElement("ul");styledOptions.classList.add("select-options");const styledList=document.createElement("div");function createOptions(item){item.querySelectorAll("select > option").forEach((function(item,index){const li=document.createElement("li");if(li.innerHTML=item.innerText,li.setAttribute("rel",item.value),multiple){let check=document.createElement("span");check.classList.add("af-check-multiple"),li.append(check)}if(0!=index||placeholder||(styledSelect.innerHTML="<span>"+item.innerText+"</span>"),item.getAttribute("selected")){function selectedText(option){if(multiple){let selected_arr=[];return option.parentNode.querySelectorAll("option[selected]").forEach((function(item){selected_arr.push(item.innerText)})),selected_arr.length?selected_arr.join(","):placeholder}return option.innerText}placeholder?(styledSelect.innerHTML='<span class="af-selected-placeholder" data-af-placeholder="'+placeholder+'">'+selectedText(item)+"</span>",li.classList.add("active")):(styledSelect.innerHTML="<span>"+selectedText(item)+"</span>",li.classList.add("active"))}item.getAttribute("disabled")||(styledOptions.appendChild(li),_this.clickEventListItem(li,item,index))}))}styledList.classList.add("select-list"),styledList.appendChild(styledOptions),item.querySelector(".select-styled")||item.appendChild(styledSelect),item.querySelector(".select-options")||item.appendChild(styledList),select.dataset.ajax&&this.ajaxOption(select,(function(arr){select.innerHTML="";let attrSelectedId=select.dataset.selected,arrtPlaceholder=select.getAttribute("placeholder");arr.unshift({text:arrtPlaceholder||"-Выберите-",value:""}),arr.forEach((function(item){let option=document.createElement("option");option.value=item.value,option.innerText=item.text,attrSelectedId==item.value&&(option.setAttribute("selected",!0),select.removeAttribute("data-selected")),select.append(option)})),createOptions(item)})),select.dataset.ajax||createOptions(item),select.afSelect=new Object,select.afSelect.open=function(){_this.openSelect(item)},select.afSelect.close=function(){_this.closeSelect()},select.afSelect.update=function(){_this.reinit(select)}}renderTemplate(){const _this=this;this.selectAll.forEach((function(item,index){if(!item.classList.contains("select-hidden")){item.classList.add("select-hidden");const wrapper=document.createElement("div");wrapper.classList.add("af-select"),item.getAttribute("multiple")&&wrapper.classList.add("af-select--multiple"),wrapper.innerHTML=item.outerHTML,item.parentNode.replaceChild(wrapper,item),_this.clickEventOpenSelect(wrapper)}})),document.querySelectorAll(".af-select").forEach((function(item,index){_this.renderOption(item)}))}openSelect(elem){document.querySelectorAll("select").forEach((function(select){select.afSelect&&select.afSelect.close()})),elem.querySelector("select").dataset.ajax&&!elem.querySelector(".select-styled").classList.contains("active")&&(elem.querySelector(".select-list").remove(),this.renderOption(elem)),elem.style.maxWidth=elem.offsetWidth+"px",elem.querySelector(".select-styled").classList.toggle("active"),elem.querySelector(".select-options").classList.toggle("active"),elem.querySelector(".select-list").classList.toggle("active"),document.querySelector("body").classList.toggle("af-select-open")}closeSelect(){if(!document.querySelector(".select-styled.active"))return!1;document.querySelector(".select-styled.active").classList.remove("active"),document.querySelector(".select-options.active").classList.remove("active"),document.querySelector(".select-list.active").classList.remove("active"),document.querySelector("body").classList.remove("af-select-open")}clickEventOut(){const _this=this;document.addEventListener("click",(function(){_this.closeSelect()}))}clickEventListItem(elem,option,index){const parentElem=option.parentNode.parentNode,_this=this,placeholder=parentElem.querySelector("select").getAttribute("placeholder"),multiple=parentElem.querySelector("select").getAttribute("multiple"),styledSelect=parentElem.querySelector(".select-styled");elem.addEventListener("click",(function(event){function selectedText(option){if(multiple){let selected_arr=[];return option.parentNode.querySelectorAll("option[selected]").forEach((function(item){selected_arr.push(item.innerText)})),selected_arr.length?selected_arr.join(","):placeholder}return option.innerText}event.stopPropagation(),event.preventDefault(),parentElem.querySelector(".select-options li.active")&&(multiple||parentElem.querySelector(".select-options li.active").classList.remove("active")),this.classList.contains("active")?(this.classList.remove("active"),option.removeAttribute("selected")):(this.classList.add("active"),option.setAttribute("selected","selected")),placeholder?styledSelect.innerHTML='<span class="af-selected-placeholder" data-af-placeholder="'+placeholder+'">'+selectedText(option)+"</span>":parentElem.querySelector(".select-styled span").innerHTML=selectedText(option),multiple||(parentElem.querySelector("select").value=this.getAttribute("rel"));var dispatchEvent=new Event("change");parentElem.querySelector("select").dispatchEvent(dispatchEvent),event.target.classList.contains("af-check-multiple")||_this.closeSelect()}))}clickEventOpenSelect(elem){const _this=this;function addEventOpen(event){event.stopPropagation(),event.preventDefault(),_this.openSelect(this)}elem.removeEventListener("click",addEventOpen),elem.addEventListener("click",addEventOpen)}}